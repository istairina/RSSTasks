import"./styles/index.scss";import errSound from"./audio/error.mp3";import rigSound from"./audio/right_answer.mp3";import congrSound from"./audio/congratulation.mp3";import{birdsData}from"./birds-data.js";let helpMode=!1;const helpME=document.querySelector(".helpme");helpME.addEventListener("click",(()=>{if(helpME.classList.toggle("help"),helpMode){helpMode=!1;for(let e=0;e<6;e++)textAnswers[e].classList.remove("help")}else{helpMode=!0;for(let e=0;e<6;e++)textAnswers[e].innerHTML==currentBird.name&&textAnswers[e].classList.add("help")}}));const birdsPic=document.querySelector(".bird__pic"),birdsPicInfo=document.querySelector(".bird__pic-info"),birdsDesc=document.querySelector(".bird__description-info"),birdsName=document.querySelector(".bird__name"),birdsNameInfo=document.querySelector(".bird__name-info"),levelsMenu=document.querySelector(".levels__menu"),textAnswers=document.querySelectorAll(".answers__item"),textAnswersBlock=document.querySelector(".answers__list"),scoreField=document.querySelector(".score"),btnNext=document.querySelector(".btn-next"),gameInfo=document.querySelector(".game-info"),birdTextInfo=document.querySelector(".bird__text-info"),resultOut=document.querySelector(".congratulation__result"),mainBlock=document.querySelector("main"),congratBlock=document.querySelector("congratulation"),btnCongratulate=document.querySelector(".congratulation__btn"),birdPlay=document.querySelector(".bird__playback"),birdPlayInfo=document.querySelector(".bird__playback-info"),currDuration=document.querySelector(".timeline__curr-duration"),totalDuration=document.querySelector(".timeline__duration"),currDurationI=document.querySelector(".timeline__curr-duration-info"),totalDurationI=document.querySelector(".timeline__duration-info"),volumeSliderQ=document.querySelector(".player__range"),volumeSliderI=document.querySelector(".player__range-info"),volumeQ=document.querySelector(".volumeQ"),volumeI=document.querySelector(".volumeI");let errorSound=new Audio(errSound),rightSound=new Audio(rigSound),congratSound=new Audio(congrSound);const audioQ=new Audio,audioI=new Audio;let saveVolumeI,saveVolumeQ,isPlayQ=!1,isPlayI=!1;function playAudio(e,t,r){"I"==r&&(stopAllSounds(),isPlayI?isPlayI=!1:(e.play(),t.innerHTML='<i class="material-icons">pause_circle_outline</i>',isPlayI=!0,isPlayQ=!1)),"Q"==r&&(stopAllSounds(),isPlayQ?isPlayQ=!1:(e.play(),t.innerHTML='<i class="material-icons">pause_circle_outline</i>',isPlayQ=!0,isPlayI=!1))}const timeline=document.querySelector(".timeline"),timelineInfo=document.querySelector(".timeline-info");function getTimeCodeFromNum(e){let t=parseInt(e),r=parseInt(t/60);return t-=60*r,r-=60*parseInt(r/60),`${String(r).padStart(2,0)}:${String(t%60).padStart(2,0)}`}timeline.addEventListener("click",(e=>{const t=window.getComputedStyle(timeline).width,r=e.offsetX/parseInt(t)*audioQ.duration;audioQ.currentTime=r}),!1),timelineInfo.addEventListener("click",(e=>{const t=window.getComputedStyle(timelineInfo).width,r=e.offsetX/parseInt(t)*audioI.duration;audioI.currentTime=r}),!1),setInterval((()=>{document.querySelector(".progress").style.width=audioQ.currentTime/audioQ.duration*100+"%",currDuration.innerHTML=getTimeCodeFromNum(audioQ.currentTime)}),500),setInterval((()=>{document.querySelector(".progress-info").style.width=audioI.currentTime/audioI.duration*100+"%",currDurationI.innerHTML=getTimeCodeFromNum(audioI.currentTime)}),500),audioQ.addEventListener("loadeddata",(()=>{totalDuration.textContent=getTimeCodeFromNum(audioQ.duration),audioQ.volume=.5}),!1),audioI.addEventListener("loadeddata",(()=>{console.log(audioI.duration),totalDurationI.textContent=getTimeCodeFromNum(audioI.duration),audioI.volume=.5}),!1),volumeSliderQ.addEventListener("input",(function(){0==this.value?volumeQ.innerHTML="volume_off_outline":volumeQ.innerHTML="volume_up_outline";let e=(this.value-this.min)/(this.max-this.min)*100;this.style.background="linear-gradient(to right, #00bc8c 0%, #00bc8c "+e+"%, #fff "+e+"%, white 100%)",audioQ.volume=volumeSliderQ.value})),volumeSliderI.addEventListener("input",(function(){0==this.value?volumeI.innerHTML="volume_off_outline":volumeI.innerHTML="volume_up_outline";let e=(this.value-this.min)/(this.max-this.min)*100;this.style.background="linear-gradient(to right, #00bc8c 0%, #00bc8c "+e+"%, #fff "+e+"%, white 100%)",audioI.volume=volumeSliderI.value})),volumeQ.addEventListener("click",(()=>{if("volume_off_outline"==volumeQ.innerHTML){volumeQ.innerHTML="volume_up_outline",volumeSliderQ.value=saveVolumeQ,audioQ.volume=saveVolumeQ;let e=(volumeSliderQ.value-volumeSliderQ.min)/(volumeSliderQ.max-volumeSliderQ.min)*100;volumeSliderQ.style.background="linear-gradient(to right, #00bc8c 0%, #00bc8c "+e+"%, #fff "+e+"%, white 100%)"}else saveVolumeQ=volumeSliderQ.value,volumeQ.innerHTML="volume_off_outline",volumeSliderQ.value=0,audioQ.volume=0,volumeSliderQ.style.background="white"})),volumeI.addEventListener("click",(()=>{if("volume_off_outline"==volumeI.innerHTML){volumeI.innerHTML="volume_up_outline",volumeSliderI.value=saveVolumeI,audioI.volume=saveVolumeI;let e=(volumeSliderI.value-volumeSliderI.min)/(volumeSliderI.max-volumeSliderI.min)*100;volumeSliderI.style.background="linear-gradient(to right, #00bc8c 0%, #00bc8c "+e+"%, #fff "+e+"%, white 100%)"}else saveVolumeI=volumeSliderI.value,volumeI.innerHTML="volume_off_outline",volumeSliderI.value=0,audioI.volume=0,volumeSliderI.style.background="white"})),birdPlay.addEventListener("click",(()=>{playAudio(audioQ,birdPlay,"Q"),console.log("booleanQ  "+isPlayQ+" "+isPlayI)})),birdPlayInfo.addEventListener("click",(()=>{playAudio(audioI,birdPlayInfo,"I"),console.log("booleanI  "+isPlayQ+" "+isPlayI)}));let birdsDataAnswers=[[],[],[],[],[],[]],score=0,scorePlus=5,finishRound=!1,resultBoolean=[];for(let e=0;e<6;e++)for(let t=0;t<6;t++)birdsDataAnswers[e].push(birdsData[e][t].name);function shuffle(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}for(let e=0;e<6;e++)shuffle(birdsData[e]),shuffle(birdsDataAnswers[e]);for(let e=0;e<6;e++){resultBoolean.push([]);for(let t=0;t<6;t++)resultBoolean[e].push(!1)}let currentBlock=0,currentLevel=birdsData[currentBlock],currentLevelId=0,currentStage=0,currentBird=currentLevel[currentStage];function drawStage(){currentBird=currentLevel[currentStage],birdsPic.innerHTML="<img  src='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQEXRYIHJ9d1g7RHYEynt1ZSoWwkbP6np4mbA&usqp=CAU' alt='unknown'>",birdsName.innerHTML="***",audioQ.src=currentBird.audio,audioQ.pause(),audioQ.currentTime=0,isPlayQ=!1,btnNext.classList.add("inactive"),btnNext.classList.remove("btn");for(let e=0;e<6;e++)textAnswers[e].innerHTML=birdsDataAnswers[currentLevelId][e],textAnswers[e].innerHTML==currentBird.name&&1==helpMode&&textAnswers[e].classList.add("help"),textAnswers[e].classList.remove("wrong"),textAnswers[e].classList.remove("right");finishRound=!1,gameInfo.style="display: block",birdTextInfo.style="display: none",birdsPicInfo.style="display: none",birdsNameInfo.style="display: none"}function drawInfo(e){let t;for(let r=0;r<6;r++)currentLevel[r].name==e&&(t=currentLevel[r]);birdsPicInfo.innerHTML=`<img src="${t.image}" alt="">`,birdsNameInfo.innerHTML=`${t.name} | ${t.species}`,birdsDesc.innerHTML=`${t.description}`,gameInfo.style="display: none",birdTextInfo.style="display: flex",birdsPicInfo.style="display: flex",birdsNameInfo.style="display: block",audioI.src=t.audio,audioI.pause(),audioI.currentTime=0,isPlayI=!1}function stopAllSounds(){let e='<i class="material-icons">play_circle_outline</i>';errorSound.pause(),errorSound.currentTime=0,rightSound.pause(),rightSound.currentTime=0,audioQ.pause(),birdPlay.innerHTML=e,audioI.pause(),birdPlayInfo.innerHTML=e}drawStage(),levelsMenu.addEventListener("click",(e=>{if(!e.target.classList.contains("inactive")){gameInfo.style="display: block",birdTextInfo.style="display: none",birdsPicInfo.style="display: none";for(let t=0;t<levelsMenu.childElementCount;t++)levelsMenu.children[t].classList.remove("active"),levelsMenu.children[t]==e.target&&(currentLevel=birdsData[t],currentLevelId=t,currentBlock=t,currentStage=0,drawStage());e.path[0].classList.add("active"),console.log(e.target)}})),textAnswersBlock.addEventListener("click",(e=>{gameInfo.style="display: none",drawInfo(e.target.innerHTML),e.target.classList.contains("right")||e.target.classList.contains("wrong")||0!=finishRound||(e.target.innerHTML==currentBird.name?(stopAllSounds(),e.target.classList.remove("help"),rightSound.play(),birdsPic.innerHTML=`<img src="${currentBird.image}" alt="">`,e.target.classList.add("right"),1!=resultBoolean[currentBlock][currentStage]&&(score+=scorePlus,scorePlus=5),resultBoolean[currentBlock][currentStage]=!0,birdsName.innerHTML=`${currentBird.name}`,finishRound=!0,btnNext.classList.remove("inactive"),btnNext.classList.add("btn"),5==currentStage&&(btnNext.innerHTML="Следующий блок",levelsMenu.children[currentBlock+1].classList.remove("inactive"),btnNext.classList.add("btn"))):(e.target.classList.add("wrong"),stopAllSounds(),isPlayQ&&audioQ.play(),errorSound.play(),1!=resultBoolean[currentBlock][currentStage]&&scorePlus--),scoreField.innerHTML=score)})),btnNext.addEventListener("click",(()=>{1==finishRound?(5==currentStage?(levelsMenu.children[currentBlock].classList.remove("active"),console.log(5==currentBlock),5==currentBlock?(mainBlock.style="display: none",congratBlock.style="display: block",score<180?resultOut.innerHTML=`Вы прошли викторину и набрали ${score} из 180 возможных баллов`:(resultOut.innerHTML="Вы прошли викторину и набрали максимальное число баллов.<br>Вы наверное орнитолог?",btnCongratulate.style="display: none",congratSound.play())):currentBlock++,console.log(currentBlock),levelsMenu.children[currentBlock].classList.add("active"),currentLevel=birdsData[currentBlock],currentLevelId=currentBlock,currentStage=0,currentBird=currentLevel[currentStage],btnNext.innerHTML="Следующее задание"):currentStage++,drawStage()):alert("Для перехода к следующему заданию необходимо завершить текущее")})),btnCongratulate.addEventListener("click",(()=>{location.reload()}));